box: ubuntu:15.04
build:
    steps:
        - add-ssh-key:
            keyname: WERCKER_GIT
        - create-file:
            name: generate ssh key
            filename: /root/.ssh/WERCKER_GIT_PRIVATE
            overwrite: true
            hide-from-log: true
            content: $WERCKER_GIT_PRIVATE
        - install-packages:
            packages: wget git
        - poppen/chefdk:
            version: 0.10.0
        - script:
            name: check version
            code: |
              ls -al
              ls -al /root/.ssh/
              cat /root/.ssh/config
              git config --global user.email "pleasemailus@wercker.com"
              git config --global user.name "wercker"
              chef exec gem install thor-scmversion
              chef exec thor 'version:current'
deploy:
    steps:
      - script:
          name: echo
          code: echo deploy stuff
    after-steps:
      - analogj/git-configure
      - poppen/chefdk:
          version: 0.10.0
      - script:
          name: bump version
          code: |
            chef exec gem install thor
            chef exec thor 'version:bump patch'
